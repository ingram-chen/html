<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I2C Slave Verilog å¯¦ç¾èˆ‡æ•™å­¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }

        header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header .subtitle {
            font-size: 1.3em;
            opacity: 0.95;
        }

        nav {
            background: #f8f9fa;
            padding: 20px 40px;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
        }

        nav a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.05em;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #764ba2;
        }

        main {
            padding: 40px;
        }

        section {
            margin-bottom: 60px;
        }

        h2 {
            color: #667eea;
            font-size: 2.2em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #764ba2;
            font-size: 1.6em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        h4 {
            color: #555;
            font-size: 1.3em;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        p {
            margin-bottom: 15px;
            font-size: 1.05em;
        }

        ul, ol {
            margin-left: 30px;
            margin-bottom: 20px;
        }

        li {
            margin-bottom: 10px;
            font-size: 1.05em;
        }

        .highlight-box {
            background: #f0f4ff;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 25px 0;
            border-radius: 5px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .feature-card h4 {
            color: #667eea;
            margin-top: 0;
        }

        code {
            background: #f4f4f4;
            padding: 3px 8px;
            border-radius: 3px;
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            font-size: 0.95em;
            color: #e83e8c;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: "Consolas", "Monaco", "Courier New", monospace;
            line-height: 1.6;
        }

        pre code {
            background: none;
            padding: 0;
            color: #f8f8f2;
        }

        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 10px 10px 10px 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 8px;
        }

        .timing-diagram {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
            overflow-x: auto;
        }

        .wave {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-family: monospace;
        }

        .wave-label {
            width: 80px;
            font-weight: bold;
            color: #667eea;
        }

        .wave-pattern {
            flex: 1;
            height: 40px;
            position: relative;
            border: 1px solid #ddd;
            background: white;
        }

        .state-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .state-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .state-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .state-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .state-table tr:hover {
            background: #f0f4ff;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 25px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 20px;
            margin: 25px 0;
            border-radius: 5px;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            
            nav ul {
                flex-direction: column;
                gap: 15px;
            }
            
            main {
                padding: 20px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>I2C Slave Verilog å¯¦ç¾èˆ‡æ•™å­¸</h1>
            <div class="subtitle">å®Œæ•´æ”¯æ´ Clock Stretching çš„é€²éš I2C å¾æ©Ÿè¨­è¨ˆ</div>
        </header>

        <nav>
            <ul>
                <li><a href="#overview">æ¦‚è¿°</a></li>
                <li><a href="#protocol">I2C å”è­°åŸç†</a></li>
                <li><a href="#statemachine">ç‹€æ…‹æ©Ÿè¨­è¨ˆ</a></li>
                <li><a href="#clockstretching">Clock Stretching</a></li>
                <li><a href="#implementation">æ ¸å¿ƒå¯¦ç¾</a></li>
                <li><a href="#timing">æ™‚åºåˆ†æ</a></li>
                <li><a href="#hardware">ç¡¬é«”è€ƒé‡</a></li>
                <li><a href="#testing">æ¸¬è©¦é©—è­‰</a></li>
            </ul>
        </nav>

        <main>
            <section id="overview">
                <h2>æ¦‚è¿°</h2>
                <p>æœ¬æ•™å­¸ä»‹ç´¹ä¸€å€‹åŠŸèƒ½å®Œæ•´çš„ I2C Slave Verilog å¯¦ç¾ï¼Œæ”¯æ´ Fast Mode (400kHz) æ“ä½œä¸¦å…·å‚™å®Œæ•´çš„ Clock Stretching åŠŸèƒ½ã€‚æ­¤è¨­è¨ˆé©åˆç”¨æ–¼éœ€è¦é«˜æ•ˆèƒ½ I2C é€šä¿¡çš„åµŒå…¥å¼ç³»çµ±ã€‚</p>
                
                <div class="highlight-box">
                    <h4>ä¸»è¦ç‰¹æ€§</h4>
                    <ul>
                        <li><span class="badge">7-bit</span> 7-bit å¾æ©Ÿåœ°å€æ”¯æ´</li>
                        <li><span class="badge">400kHz</span> Fast Mode é€Ÿç‡æ”¯æ´</li>
                        <li><span class="badge">Clock Stretching</span> å®Œæ•´æ™‚é˜å»¶ä¼¸åŠŸèƒ½</li>
                        <li><span class="badge">Open-drain</span> é–‹æ¼è¼¸å‡ºè¨­è¨ˆ</li>
                        <li><span class="badge">Synthesizable</span> å¯ç¶œåˆçš„ RTL è¨­è¨ˆ</li>
                    </ul>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ”§ æ¨¡çµ„åŒ–è¨­è¨ˆ</h4>
                        <p>æ¡ç”¨ç‹€æ…‹æ©Ÿæ¶æ§‹ï¼Œå„åŠŸèƒ½æ¨¡çµ„ç¨ç«‹è¨­è¨ˆï¼Œä¾¿æ–¼ç¶­è­·å’Œæ“´å±•ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <h4>âš¡ é«˜æ•ˆèƒ½</h4>
                        <p>æ”¯æ´ Fast Mode 400kHz æ“ä½œï¼Œæ»¿è¶³å¤§å¤šæ•¸æ‡‰ç”¨éœ€æ±‚ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ›¡ï¸ é­¯æ£’æ€§</h4>
                        <p>å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæ¢ä»¶æª¢æ¸¬ï¼Œç¢ºä¿ç©©å®šæ“ä½œã€‚</p>
                    </div>
                </div>
            </section>

            <section id="protocol">
                <h2>I2C å”è­°åŸç†</h2>
                
                <h3>åŸºæœ¬æ¦‚å¿µ</h3>
                <p>I2C (Inter-Integrated Circuit) æ˜¯ä¸€ç¨®åŒæ­¥ä¸²è¡Œé€šä¿¡å”è­°ï¼Œä½¿ç”¨å…©æ¢ä¿¡è™Ÿç·šï¼šSCL (æ™‚é˜) å’Œ SDA (æ•¸æ“š)ã€‚å”è­°æ”¯æ´å¤šä¸»æ©Ÿã€å¤šå¾æ©Ÿæ¶æ§‹ï¼Œå…·æœ‰åœ°å€æ©Ÿåˆ¶å’Œä»²è£åŠŸèƒ½ã€‚</p>

                <h3>START/STOP æ¢ä»¶</h3>
                <div class="highlight-box">
                    <ul>
                        <li><strong>START æ¢ä»¶</strong>ï¼šSCL ä¿æŒé«˜é›»ä½æ™‚ï¼ŒSDA ç”±é«˜è®Šä½</li>
                        <li><strong>STOP æ¢ä»¶</strong>ï¼šSCL ä¿æŒé«˜é›»ä½æ™‚ï¼ŒSDA ç”±ä½è®Šé«˜</li>
                        <li><strong>é‡è¤‡ START</strong>ï¼šåœ¨å‚³è¼¸éç¨‹ä¸­é‡æ–°ç™¼å‡º START æ¢ä»¶</li>
                    </ul>
                </div>

                <h3>æ•¸æ“šå‚³è¼¸æ ¼å¼</h3>
                <p>æ¯å€‹å­—ç¯€å‚³è¼¸åŒ…å« 8 å€‹æ•¸æ“šä½ï¼Œå¾Œè·Ÿä¸€å€‹ ACK/NACK ä½ã€‚æ•¸æ“šåœ¨ SCL é«˜é›»ä½æœŸé–“ç©©å®šï¼Œåœ¨ SCL ä½é›»ä½æœŸé–“å¯ä»¥æ”¹è®Šã€‚</p>

                <div class="timing-diagram">
                    <h4>åŸºæœ¬å‚³è¼¸æ™‚åº</h4>
                    <div class="wave">
                        <div class="wave-label">SCL</div>
                        <div class="wave-pattern">â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â”</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">SDA</div>
                        <div class="wave-pattern">â”€â”˜ â””â”€â”˜ â””â”€â”˜ â””â”€â”</div>
                    </div>
                </div>

                <h3>åœ°å€å¹€æ ¼å¼</h3>
                <p>åœ°å€å¹€åŒ…å« 7-bit å¾æ©Ÿåœ°å€å’Œ 1-bit è®€å¯«æ§åˆ¶ä½ï¼š</p>
                <ul>
                    <li>åœ°å€ä½ A6-A0ï¼šæŒ‡å®šç›®æ¨™å¾æ©Ÿ</li>
                    <li>R/W ä½ï¼š0 è¡¨ç¤ºå¯«å…¥ï¼Œ1 è¡¨ç¤ºè®€å–</li>
                </ul>
            </section>

            <section id="statemachine">
                <h2>ç‹€æ…‹æ©Ÿè¨­è¨ˆ</h2>
                <p>I2C Slave çš„æ ¸å¿ƒæ˜¯ç‹€æ…‹æ©Ÿï¼Œè² è²¬è™•ç†å„ç¨®é€šä¿¡éšæ®µå’Œæ¢ä»¶è½‰æ›ã€‚</p>

                <h3>ç‹€æ…‹å®šç¾©</h3>
                <table class="state-table">
                    <thead>
                        <tr>
                            <th>ç‹€æ…‹</th>
                            <th>æè¿°</th>
                            <th>è§¸ç™¼æ¢ä»¶</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>IDLE</code></td>
                            <td>ç©ºé–’ç‹€æ…‹ï¼Œç­‰å¾… START æ¢ä»¶</td>
                            <td>å¾©ä½æˆ– STOP æ¢ä»¶</td>
                        </tr>
                        <tr>
                            <td><code>ADDR_PHASE</code></td>
                            <td>æ¥æ”¶ 7-bit åœ°å€</td>
                            <td>æª¢æ¸¬åˆ° START æ¢ä»¶</td>
                        </tr>
                        <tr>
                            <td><code>ADDR_ACK</code></td>
                            <td>ç™¼é€åœ°å€ ACK/NACK</td>
                            <td>åœ°å€æ¥æ”¶å®Œæˆ</td>
                        </tr>
                        <tr>
                            <td><code>READ_PHASE</code></td>
                            <td>å‚³è¼¸è®€å–æ•¸æ“š</td>
                            <td>åœ°å€åŒ¹é…ä¸” R/W=1</td>
                        </tr>
                        <tr>
                            <td><code>READ_ACK</code></td>
                            <td>ç­‰å¾…ä¸»æ©Ÿ ACK/NACK</td>
                            <td>æ•¸æ“šå‚³è¼¸å®Œæˆ</td>
                        </tr>
                        <tr>
                            <td><code>WRITE_PHASE</code></td>
                            <td>æ¥æ”¶å¯«å…¥æ•¸æ“š</td>
                            <td>åœ°å€åŒ¹é…ä¸” R/W=0</td>
                        </tr>
                        <tr>
                            <td><code>WRITE_ACK</code></td>
                            <td>ç™¼é€æ•¸æ“š ACK/NACK</td>
                            <td>æ•¸æ“šæ¥æ”¶å®Œæˆ</td>
                        </tr>
                    </tbody>
                </table>

                <h3>ç‹€æ…‹è½‰æ›é‚è¼¯</h3>
                <pre><code>// ç‹€æ…‹è½‰æ›çš„æ ¸å¿ƒé‚è¼¯
always @(*) begin
    next_state = state;
    
    case (state)
        IDLE: begin
            if (start_condition) begin
                next_state = ADDR_PHASE;
            end
        end
        
        ADDR_PHASE: begin
            if (bit_counter == 3'd7 && scl_falling) begin
                next_state = ADDR_ACK;
            end
        end
        
        // ... å…¶ä»–ç‹€æ…‹è½‰æ›
    endcase
end</code></pre>
            </section>

            <section id="clockstretching">
                <h2>Clock Stretching è©³è§£</h2>
                <p>Clock Stretching æ˜¯ I2C å”è­°çš„é‡è¦ç‰¹æ€§ï¼Œå…è¨±å¾æ©Ÿåœ¨éœ€è¦æ›´å¤šè™•ç†æ™‚é–“æ™‚æš«åœä¸»æ©Ÿçš„æ™‚é˜ä¿¡è™Ÿã€‚</p>

                <h3>ä½•æ™‚ä½¿ç”¨ Clock Stretching</h3>
                <div class="highlight-box">
                    <ul>
                        <li><strong>æ•¸æ“šè™•ç†æ™‚é–“</strong>ï¼šå¾æ©Ÿéœ€è¦æ™‚é–“è™•ç†æ¥æ”¶åˆ°çš„æ•¸æ“š</li>
                        <li><strong>ç·©è¡å€ç®¡ç†</strong>ï¼šå…§éƒ¨ç·©è¡å€æ»¿æˆ–ç©ºæ™‚éœ€è¦ç­‰å¾…</li>
                        <li><strong>ä¸­æ–·è™•ç†</strong>ï¼šéŸ¿æ‡‰é«˜å„ªå…ˆç´šä¸­æ–·æ™‚æš«åœé€šä¿¡</li>
                        <li><strong>åŠŸè€—ç®¡ç†</strong>ï¼šåœ¨ä½åŠŸè€—æ¨¡å¼ä¸‹å»¶é²éŸ¿æ‡‰</li>
                    </ul>
                </div>

                <h3>å¯¦ç¾æ©Ÿåˆ¶</h3>
                <p>å¾æ©Ÿé€šéå°‡ SCL ç·šæ‹‰ä½ä¾†å¯¦ç¾ Clock Stretchingã€‚ç”±æ–¼ I2C ä½¿ç”¨é–‹æ¼è¼¸å‡ºï¼Œä»»ä½•è¨­å‚™éƒ½å¯ä»¥æ‹‰ä½ SCL ç·šã€‚</p>

                <div class="timing-diagram">
                    <h4>Clock Stretching æ™‚åº</h4>
                    <div class="wave">
                        <div class="wave-label">SCL</div>
                        <div class="wave-pattern">â”Œâ”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">SDA</div>
                        <div class="wave-pattern">â”€â”˜ â””â”€â”˜     â””â”€â”˜</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">è¨»è§£</div>
                        <div class="wave-pattern">  æ­£å¸¸    æ‹‰ä½å»¶ä¼¸  æ­£å¸¸</div>
                    </div>
                </div>

                <h3>Verilog å¯¦ç¾</h3>
                <pre><code>// Clock stretching æ§åˆ¶é‚è¼¯
always @(posedge clk or negedge reset_n) begin
    if (!reset_n) begin
        clock_stretch <= 1'b0;
    end else begin
        // åœ¨è™•ç†éšæ®µå•Ÿç”¨ clock stretching
        if ((state == WRITE_ACK && scl_falling) ||
            (state == READ_ACK && scl_falling)) begin
            clock_stretch <= 1'b1;  // æ‹‰ä½ SCL
        end else if (clock_stretch && scl_in == 1'b0) begin
            clock_stretch <= 1'b0;  // é‡‹æ”¾ SCL
        end
    end
end

// é–‹æ¼è¼¸å‡ºé©…å‹•
assign scl_out = clock_stretch ? 1'b0 : 1'b1;</code></pre>
            </section>

            <section id="implementation">
                <h2>æ ¸å¿ƒå¯¦ç¾</h2>

                <h3>æ¨¡çµ„æ¥å£</h3>
                <pre><code>module i2c_slave_CTO (
    // ç³»çµ±ä¿¡è™Ÿ
    input  wire        clk,           // ç³»çµ±æ™‚é˜
    input  wire        reset_n,       // ä½é›»ä½å¾©ä½
    
    // I2C åŒ¯æµæ’ä¿¡è™Ÿ (é–‹æ¼)
    input  wire        scl_in,        // SCL è¼¸å…¥
    input  wire        sda_in,        // SDA è¼¸å…¥
    output wire        scl_out,       // SCL è¼¸å‡º
    output wire        sda_out,       // SDA è¼¸å‡º
    
    // å¾æ©Ÿé…ç½®
    input  wire [6:0]  slave_addr,    // 7-bit å¾æ©Ÿåœ°å€
    
    // æ•¸æ“šä»‹é¢
    input  wire [7:0]  data_in,       // è¦å‚³é€çš„æ•¸æ“š
    output reg  [7:0]  data_out,      // æ¥æ”¶åˆ°çš„æ•¸æ“š
    
    // æ§åˆ¶ä¿¡è™Ÿ
    output reg         read_req,      // è®€å–è«‹æ±‚
    output reg         write_req,     // å¯«å…¥è«‹æ±‚
    input  wire        ack_bit,       // ä¾†è‡ªç”¨æˆ¶é‚è¼¯çš„ ACK
    output reg         transfer_done, // å‚³è¼¸å®Œæˆ
    
    // ç‹€æ…‹ä¿¡è™Ÿ
    output reg         bus_busy,      // åŒ¯æµæ’å¿™ç¢Œ
    output reg         addr_match     // åœ°å€åŒ¹é…
);</code></pre>

                <h3>é‚Šç·£æª¢æ¸¬</h3>
                <pre><code>// SCL å’Œ SDA é‚Šç·£æª¢æ¸¬
reg        scl_prev;
reg        sda_prev;
wire       scl_rising  = scl_in & ~scl_prev;
wire       scl_falling = ~scl_in & scl_prev;
wire       sda_rising  = sda_in & ~sda_prev;
wire       sda_falling = ~sda_in & sda_prev;

// START/STOP æ¢ä»¶æª¢æ¸¬
wire       start_condition = scl_in & sda_falling;
wire       stop_condition  = scl_in & sda_rising;</code></pre>

                <h3>æ•¸æ“šç§»ä½æš«å­˜å™¨</h3>
                <pre><code>// ç§»ä½æš«å­˜å™¨å’Œæ•¸æ“šè™•ç†
always @(posedge clk or negedge reset_n) begin
    if (!reset_n) begin
        shift_reg <= 8'd0;
        received_addr <= 7'd0;
        rw_bit <= 1'b0;
    end else begin
        case (state)
            ADDR_PHASE: begin
                if (scl_rising) begin
                    shift_reg <= {shift_reg[6:0], sda_in};
                end
            end
            WRITE_PHASE: begin
                if (scl_rising) begin
                    shift_reg <= {shift_reg[6:0], sda_in};
                end
            end
        endcase
    end
end</code></pre>

                <h3>åœ°å€åŒ¹é…é‚è¼¯</h3>
                <pre><code>// åœ°å€åŒ¹é…æª¢æ¸¬
always @(posedge clk or negedge reset_n) begin
    if (!reset_n) begin
        addr_match <= 1'b0;
    end else begin
        if (state == ADDR_ACK && scl_falling) begin
            addr_match <= (received_addr == slave_addr);
        end else if (state == IDLE) begin
            addr_match <= 1'b0;
        end
    end
end</code></pre>
            </section>

            <section id="timing">
                <h2>æ™‚åºåˆ†æ</h2>

                <h3>æ­£å¸¸å¯«å…¥å‚³è¼¸</h3>
                <div class="timing-diagram">
                    <h4>å¯«å…¥æ“ä½œå®Œæ•´æ™‚åº</h4>
                    <div class="wave">
                        <div class="wave-label">SCL</div>
                        <div class="wave-pattern">â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â”</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">SDA</div>
                        <div class="wave-pattern">â”€â”˜ A6 A5 A4 A3 A2 A1 A0 W â””â”€â”˜ D7 D6 D5 D4 D3 D2 D1 D0 â””â”€â”</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">ç‹€æ…‹</div>
                        <div class="wave-pattern">  START    ADDR_PHASE    ACK   WRITE_PHASE    ACK   STOP</div>
                    </div>
                </div>

                <h3>æ­£å¸¸è®€å–å‚³è¼¸</h3>
                <div class="timing-diagram">
                    <h4>è®€å–æ“ä½œå®Œæ•´æ™‚åº</h4>
                    <div class="wave">
                        <div class="wave-label">SCL</div>
                        <div class="wave-pattern">â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â”</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">SDA</div>
                        <div class="wave-pattern">â”€â”˜ A6 A5 A4 A3 A2 A1 A0 R â””â”€â”˜ D7 D6 D5 D4 D3 D2 D1 D0 â””â”€â”</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">ç‹€æ…‹</div>
                        <div class="wave-pattern">  START    ADDR_PHASE    ACK   READ_PHASE     ACK   STOP</div>
                    </div>
                </div>

                <h3>Clock Stretching å ´æ™¯</h3>
                <div class="timing-diagram">
                    <h4>åŒ…å« Clock Stretching çš„å¯«å…¥æ“ä½œ</h4>
                    <div class="wave">
                        <div class="wave-label">SCL</div>
                        <div class="wave-pattern">â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â” â”Œâ”€â”</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">SDA</div>
                        <div class="wave-pattern">â”€â”˜ A6 A5 A4 A3 A2 A1 A0 W â””â”€â”˜ D7 D6</div>
                    </div>
                    <div class="wave">
                        <div class="wave-label">è¨»è§£</div>
                        <div class="wave-pattern">                  è™•ç†å»¶é² (Clock Stretching)</div>
                    </div>
                </div>

                <h3>é—œéµæ™‚åºåƒæ•¸</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>Fast Mode è¦æ ¼</h4>
                        <ul>
                            <li>æœ€å¤§æ™‚é˜é »ç‡ï¼š400 kHz</li>
                            <li>æœ€å° SCL ä½æ™‚é–“ï¼š1.3 Î¼s</li>
                            <li>æœ€å° SCL é«˜æ™‚é–“ï¼š0.6 Î¼s</li>
                            <li>æœ€å¤§ SCL ä¸Šå‡æ™‚é–“ï¼š300 ns</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>å»ºç«‹ä¿æŒæ™‚é–“</h4>
                        <ul>
                            <li>SDA å»ºç«‹æ™‚é–“ï¼š100 ns</li>
                            <li>SDA ä¿æŒæ™‚é–“ï¼š0 ns</li>
                            <li>START å»ºç«‹æ™‚é–“ï¼š0.6 Î¼s</li>
                            <li>STOP å»ºç«‹æ™‚é–“ï¼š0.6 Î¼s</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="hardware">
                <h2>ç¡¬é«”è¨­è¨ˆè€ƒé‡</h2>

                <h3>é–‹æ¼è¼¸å‡ºè¨­è¨ˆ</h3>
                <p>I2C å”è­°è¦æ±‚é–‹æ¼è¼¸å‡ºï¼Œå¯¦ç¾ç·šèˆ‡é‚è¼¯ã€‚åœ¨ FPGA/ASIC ä¸­éœ€è¦ç‰¹åˆ¥è™•ç†ï¼š</p>
                <pre><code>// é–‹æ¼è¼¸å‡ºå¯¦ç¾
assign scl_out = clock_stretch ? 1'b0 : 1'b1;  // 1 è¡¨ç¤ºé«˜é˜»æŠ—
assign sda_out = sda_out_reg ? 1'b1 : 1'b0;   // 1 è¡¨ç¤ºé«˜é˜»æŠ—

// å¤–éƒ¨éœ€è¦ä¸Šæ‹‰é›»é˜»
// FPGA: è¨­å®š IO ç‚ºé–‹æ¼æ¨¡å¼
// ASIC: ä½¿ç”¨é–‹æ¼è¼¸å‡ºå–®å…ƒ</code></pre>

                <div class="warning-box">
                    <h4>âš ï¸ é‡è¦æ³¨æ„äº‹é …</h4>
                    <ul>
                        <li>å¿…é ˆä½¿ç”¨å¤–éƒ¨ä¸Šæ‹‰é›»é˜» (å…¸å‹å€¼ 2.2kÎ©-10kÎ©)</li>
                        <li>FPGA IO éœ€é…ç½®ç‚ºé–‹æ¼æ¨¡å¼</li>
                        <li>é¿å…å…§éƒ¨ä¸Šæ‹‰ï¼Œå¯èƒ½å½±éŸ¿æ™‚åº</li>
                    </ul>
                </div>

                <h3>ä¿¡è™Ÿå®Œæ•´æ€§</h3>
                <div class="highlight-box">
                    <h4>å»æŠ–å‹•è¨­è¨ˆ</h4>
                    <pre><code>// ç°¡å–®çš„ä¿¡è™ŸåŒæ­¥
always @(posedge clk or negedge reset_n) begin
    if (!reset_n) begin
        scl_sync <= 2'b11;
        sda_sync <= 2'b11;
    end else begin
        scl_sync <= {scl_sync[0], scl_in};
        sda_sync <= {sda_sync[0], sda_in};
    end
end</code></pre>
                </div>

                <h3>é‚Šç•Œæ¢ä»¶è™•ç†</h3>
                <ul>
                    <li><strong>åŒ¯æµæ’æ›èµ·</strong>ï¼šæª¢æ¸¬ SCL/SDA é•·æ™‚é–“ä½é›»ä½</li>
                    <li><strong>ç«¶çˆ­æ¢ä»¶</strong>ï¼šç¢ºä¿ç‹€æ…‹è½‰ç§»çš„åŸå­æ€§</li>
                    <li><strong>äºç©©æ…‹</strong>ï¼šé©ç•¶çš„ä¿¡è™ŸåŒæ­¥</li>
                    <li><strong>é›»æºå™ªè²</strong>ï¼šé©ç•¶çš„æ¿¾æ³¢å’Œå»è€¦</li>
                </ul>

                <h3>æ™‚é˜åŸŸäº¤å‰</h3>
                <p>I2C æ™‚é˜ (SCL) èˆ‡ç³»çµ±æ™‚é˜ (clk) å±¬æ–¼ä¸åŒæ™‚é˜åŸŸï¼Œéœ€è¦å°å¿ƒè™•ç†ï¼š</p>
                <pre><code>// è·¨æ™‚é˜åŸŸä¿¡è™Ÿè™•ç†
always @(posedge clk or negedge reset_n) begin
    if (!reset_n) begin
        scl_prev <= 1'b1;
        sda_prev <= 1'b1;
    end else begin
        scl_prev <= scl_in;    // åŒæ­¥åˆ°ç³»çµ±æ™‚é˜åŸŸ
        sda_prev <= sda_in;
    end
end</code></pre>
            </section>

            <section id="testing">
                <h2>æ¸¬è©¦é©—è­‰</h2>

                <h3>æ¸¬è©¦ç­–ç•¥</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>å–®å…ƒæ¸¬è©¦</h4>
                        <ul>
                            <li>ç‹€æ…‹æ©Ÿè½‰ç§»æ¸¬è©¦</li>
                            <li>åœ°å€åŒ¹é…é‚è¼¯é©—è­‰</li>
                            <li>Clock Stretching åŠŸèƒ½</li>
                            <li>é‚Šç•Œæ¢ä»¶è™•ç†</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>é›†æˆæ¸¬è©¦</h4>
                        <ul>
                            <li>å®Œæ•´å‚³è¼¸åºåˆ—æ¸¬è©¦</li>
                            <li>å¤šä¸»æ©Ÿç’°å¢ƒæ¨¡æ“¬</li>
                            <li>éŒ¯èª¤æ³¨å…¥æ¸¬è©¦</li>
                            <li>æ•ˆèƒ½å’Œæ™‚åºæ¸¬è©¦</li>
                        </ul>
                    </div>
                </div>

                <h3>æ¸¬è©¦å¹³å°æ¶æ§‹</h3>
                <pre><code>// æ¸¬è©¦å¹³å°åŸºæœ¬çµæ§‹
module i2c_slave_tb;
    reg         clk;
    reg         reset_n;
    reg         scl_in;
    reg         sda_in;
    wire        scl_out;
    wire        sda_out;
    
    // I2C Master æ¨¡å‹
    reg [6:0]   master_addr;
    reg [7:0]   master_data;
    reg         master_rw;
    
    // æ¸¬è©¦æ§åˆ¶
    reg         start_test;
    reg [31:0]  test_count;
    
    i2c_slave_CTO uut (
        .clk(clk),
        .reset_n(reset_n),
        .scl_in(scl_in),
        .sda_in(sda_in),
        .scl_out(scl_out),
        .sda_out(sda_out),
        // ... å…¶ä»–é€£æ¥
    );
    
    // Master æ™‚åºç”Ÿæˆ
    task i2c_write;
        input [6:0] addr;
        input [7:0] data;
        // å¯¦ç¾ I2C å¯«å…¥æ™‚åº
    endtask
    
    task i2c_read;
        input [6:0] addr;
        output [7:0] data;
        // å¯¦ç¾ I2C è®€å–æ™‚åº
    endtask
endmodule</code></pre>

                <h3>é©—è­‰é‡é»</h3>
                <div class="success-box">
                    <h4>âœ… é—œéµé©—è­‰é …ç›®</h4>
                    <ol>
                        <li><strong>å”è­°ä¸€è‡´æ€§</strong>ï¼šåš´æ ¼éµå¾ª I2C è¦ç¯„</li>
                        <li><strong>æ™‚åºè¦æ±‚</strong>ï¼šæ»¿è¶³ Fast Mode æ™‚åºè¦æ ¼</li>
                        <li><strong>Clock Stretching</strong>ï¼šæ­£ç¢ºçš„å»¶ä¼¸å’Œé‡‹æ”¾æ™‚æ©Ÿ</li>
                        <li><strong>éŒ¯èª¤è™•ç†</strong>ï¼šç•°å¸¸æƒ…æ³çš„æ¢å¾©èƒ½åŠ›</li>
                        <li><strong>ä¸¦ç™¼æ“ä½œ</strong>ï¼šå¤šä¸»æ©Ÿä»²è£è™•ç†</li>
                    </ol>
                </div>

                <h3>ä»¿çœŸå»ºè­°</h3>
                <ul>
                    <li>ä½¿ç”¨è¡Œç‚ºç´šæ¨¡å‹é©—è­‰å”è­°é‚è¼¯</li>
                    <li>é€²è¡Œé–€ç´šä»¿çœŸé©—è­‰æ™‚åºç‰¹æ€§</li>
                    <li>æ·»åŠ å»¶æ™‚æ¨¡å‹æ¸¬è©¦æ¥µé™æƒ…æ³</li>
                    <li>ä½¿ç”¨æ–·è¨€æª¢æŸ¥å”è­°é•è¦</li>
                </ul>

                <h3>ç¡¬é«”é©—è­‰</h3>
                <div class="highlight-box">
                    <h4>å¯¦é©—å®¤æ¸¬è©¦</h4>
                    <ul>
                        <li><strong>é‚è¼¯åˆ†æå„€</strong>ï¼šæ•ç²å¯¦éš› I2C æ³¢å½¢</li>
                        <li><strong>ç¤ºæ³¢å™¨</strong>ï¼šæ¸¬é‡æ™‚åºåƒæ•¸</li>
                        <li><strong>å”è­°åˆ†æå„€</strong>ï¼šé©—è­‰å”è­°ç¬¦åˆæ€§</li>
                        <li><strong>å£“åŠ›æ¸¬è©¦</strong>ï¼šé•·æ™‚é–“é‹è¡Œç©©å®šæ€§</li>
                    </ul>
                </div>
            </section>

            <section>
                <h2>ç¸½çµ</h2>
                <p>æœ¬æ•™å­¸ä»‹ç´¹çš„ I2C Slave Verilog å¯¦ç¾æä¾›äº†å®Œæ•´çš„åŠŸèƒ½æ”¯æ´ï¼ŒåŒ…æ‹¬ Clock Stretchingã€éŒ¯èª¤è™•ç†å’Œæ™‚åºå„ªåŒ–ã€‚æ­¤è¨­è¨ˆå¯ä»¥ç›´æ¥æ‡‰ç”¨æ–¼å¯¦éš›å°ˆæ¡ˆï¼Œæˆ–ä½œç‚ºæ›´è¤‡é›œ I2C å¯¦ç¾çš„åŸºç¤ã€‚</p>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ¯ è¨­è¨ˆå„ªå‹¢</h4>
                        <ul>
                            <li>å®Œå…¨ç¬¦åˆ I2C è¦ç¯„</li>
                            <li>æ”¯æ´ Fast Mode æ“ä½œ</li>
                            <li>é­¯æ£’çš„éŒ¯èª¤è™•ç†</li>
                            <li>å¯ç¶œåˆçš„ RTL è¨­è¨ˆ</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸš€ æ‡‰ç”¨å ´æ™¯</h4>
                        <ul>
                            <li>åµŒå…¥å¼ç³»çµ±é€šä¿¡</li>
                            <li>æ„Ÿæ¸¬å™¨ä»‹é¢</li>
                            <li>è¨˜æ†¶é«”æ“´å±•</li>
                            <li>é…ç½®ç®¡ç†</li>
                        </ul>
                    </div>
                </div>

                <div class="highlight-box">
                    <h4>ä¸‹ä¸€æ­¥å»ºè­°</h4>
                    <ul>
                        <li>æ ¹æ“šç‰¹å®šæ‡‰ç”¨èª¿æ•´åƒæ•¸</li>
                        <li>æ·»åŠ  DMA æ”¯æ´ä»¥æé«˜æ•ˆèƒ½</li>
                        <li>å¯¦ç¾å¤šå¾æ©Ÿåœ°å€æ”¯æ´</li>
                        <li>è€ƒæ…®æ·»åŠ ä½åŠŸè€—æ¨¡å¼</li>
                    </ul>
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <a href="i2c_slave_CTO.v" class="btn" download>ä¸‹è¼‰ Verilog åŸå§‹ç¢¼</a>
                    <a href="#" class="btn">è¿”å›é ‚éƒ¨</a>
                </div>
            </section>
        </main>
    </div>
</body>
</html>